(function(){var h={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,L_START:91,R_START:92,L_CMD:91,R_CMD:93,MENU:93,N0:96,N1:97,N2:98,N3:99,N4:100,N5:101,N6:102,N7:103,N8:104,N9:105,"N*":106,"N+":107,
"N-":109,"N.":110,"N/":111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F9:120,F10:121,NUM_LOCK:144,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},p={";":59,"=":61,"-":109,L_START:219,N0:48,N1:49,N2:50,N3:51,N4:52,N5:53,N6:54,N7:55,N8:56,N9:57,"N*":42,"N+":43,"N-":45,"N.":78,"N/":47},q={";":59,"=":107,"-":109},r={";":59,"=":61,"-":173},s={add:function(a,c){void 0==a.start&&(a.start={});a.start[h[c[0]]]?a.start[h[c[0]]]++:a.start[h[c[0]]]=1;for(var b=
c.length,d,e,f=0;f<b-1;f++)d=h[c[f]],e=h[c[f+1]],void 0==a[d]&&(a[d]={}),a[d][e]?a[d][e]++:a[d][e]=1}},m={is_string:function(a){return"[object String]"===Object.prototype.toString.call(a)},is_boolean:function(a){return"[object Boolean]"===Object.prototype.toString.call(a)},is_function:function(a){return"[object Function]"===Object.prototype.toString.call(a)},is_undefined:function(a){return void 0===a},is_empty:function(a){if(null==a)return!0;if(0<a.length)return!1;if(0===a.length)return!0;for(var c in a)if(this.hasProp(a,
c))return!1;return!0},cross_browser:function(){var a=this.get_user_browser();-1!=a.indexOf("Opera")&&12>a.substring(6,a.length)?this.extend(h,p):-1!=a.indexOf("Firefox")&&15>a.substring(8,a.length)?this.extend(h,q):-1!=a.indexOf("Firefox")&&15<=a.substring(8,a.length)&&this.extend(h,r)},get_user_browser:function(){var a=navigator.userAgent,c,b;b=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(b[1]))return c=/\brv[ :]+(\d+)/g.exec(ua)||[],"IE "+(c[1]||
"");if("Chrome"===b[1]&&(c=a.match(/\bOPR\/(\d+)/),null!=c))return"Opera "+c[1];b=b[2]?[b[1],b[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(c=a.match(/version\/(\d+)/i))&&b.splice(1,1,c[1]);return b.join(" ")},extend:function(a,c){for(var b in c)a[b]=c[b]},same_array:function(a,c){if(a.length!==c.length)return!1;for(var b=a.length,d=0;d<b;d++)if(a[d]!==c[d])return!1;return!0},hasProp:function(a,c){return Object.prototype.hasOwnProperty.call(a,c)},string_to_array:function(a){a=a.toUpperCase().replace(/\s+/g,
" ").split(" ");for(var c=0;c<a.length;c++)""==a[c]&&a.splice(c,1);return a},string_to_object:function(a){var c={};a=this.string_to_array(a);for(var b=a.length,d=0;d<b;d++)c[a[d]]?++c[a[d]]:c[a[d]]=1;return c},attach_event:function(a,c,b){document.addEventListener?a.addEventListener(c,b):document.attachEvent&&a.attachEvent("on"+c,b)},register_keys:function(a,c){for(var b=a.length,d=0;d<b;d++){if(void 0===h[a[d]])throw"Not support "+a[d];c.active_keys[h[a[d]]]?c.active_keys[h[a[d]]]++:c.active_keys[h[a[d]]]=
1}},keys_to_keycode:function(a){var c="";a=string_to_array(a);for(var b=a.length,d=0;d<b;d++)c=d==b-1?c+a[d]:c+a[d]+" ";return c},make_package:function(a,c,b,d){var e={},f={};f.order=c;f.callback=b;f.time=d;e[a]=f;return e},store_sizetable:function(a,c){var b=c.size_table,d="";b[a]?(d=b[a][b[a].length-1],d=a.toString()+(parseInt(d.substr(1,d.length-1))+1),b[a].push(d)):(d=a.toString()+1,b[a]=[d]);return d},store_keypackage:function(a,c,b,d,e,f){var g={},k=c?this.string_to_array(a):this.string_to_object(a);
g.key=k;g.key_origin=a;g.order=c;g.time=1E3*d;g.callback=b;g.keep_fire=!1;g.count=0;f.keys_package[e]=g},add_to_first:function(a,c,b){b=b.first_to_id;void 0==b[a]&&(b[a]=[]);b[a].push(c)},add_combo:function(a,c,b,d,e){if(!this.is_string(a))throw'function(ordered_combo) expects "keys" to be string';if(!this.is_function(c))throw'function(ordered_combo) expects "callback" to be function';var f=this.string_to_array(a);if(!this.is_empty(f)){this.register_keys(f,e);var g=this.store_sizetable(f.length,e);
this.store_keypackage(a,d,c,b,g,e);d&&(this.add_to_first(h[f[0]],g,e),s.add(e.machine,f))}},remove_firstoid:function(a,c,b){a=b.first_to_id[a];b=a.length;for(var d=0;d<b;d++)if(a[d]==c){a.splice(d,1);break}},remove_package:function(a,c){var b=c.keys_package;if(this.is_empty(b))return!1;for(var d=c.size_table,e=d[a.length],f=e.length,g,k=0;k<f;k++)if(g=e[k],this.same_array(a,b[g].key))return d[a.length].splice(k,1),delete b[g],this.remove_firstoid(h[a[0]],g,c),!0;return!1},remove_activekeys:function(a,
c){for(var b=c.active_keys,d=a.length,e=0;e<d;e++)1==b[h[a[e]]]?delete b[h[a[e]]]:b[h[a[e]]]--},remove_machine:function(a,c){var b=c.machine,d=a.length,e,f;e=h[a[0]];1==b.start[e]?delete b.start[e]:b.start[e]--;for(var g=0;g<d-1;g++)e=h[a[g]],f=h[a[g+1]],1==b[e][f]?delete b[e][f]:b[e][f]--},destroy_combo:function(a,c){var b=this.string_to_array(a);this.remove_package(b,c)&&(this.remove_activekeys(b,c),this.remove_machine(b,c))},destroy_all:function(a){a.active_keys={};a.keys_package={};a.size_table=
{};a.first_to_id={};a.machine={};a.keydown_buffer=[];a.keyup_buffer=[]},makeup_keyup_obj:function(a,c,b){b={};b.current=a;b.id=c;b.pass=1;b.v=!0;return b},timer:function(a,c,b,d){setTimeout(function(a){return function(){var f=d.keyup_buffer;if(!a.is_empty(f))for(var g=0;g<=b&&!a.is_empty(f);g++)if(c==f[g].id){f[g].v=!1;break}}}(this),a)},fire:function(a,c){for(var b=c.keys_package,d=a.length,e,f=0;f<d;f++)e=b[a[f]].callback,b[a[f]].count++,e()},fire_keydown:function(a,c){},fire_keyup:function(a,c){if(this.hasProp(c.active_keys,
a)){for(var b=c.keyup_buffer,d=c.keys_package,e=c.first_to_id,f=c.machine,g=[],k,m,l=0;l<b.length;l++)k=b[l],m=d[k.id],k.v?this.hasProp(f[k.current],a)&&h[m.key[k.pass]]==a?k.pass+1==m.key.length?(g.push(k.id),b.splice(l,1),l--):(k.current=a,k.pass++):(b.splice(l,1),l--):(b.splice(l,1),l--);if(this.hasProp(f.start,a))for(e=e[a],f=e.length,l=0;l<f;l++)1==d[e[l]].key.length?g.push(e[l]):(k=d[e[l]].time,b.push(this.makeup_keyup_obj(a,e[l],c)),k&&this.timer(k,e[l],l,c));0<g.length&&this.fire(g,c)}else c.keyup_buffer=
[]},count:function(a,c){var b=0,d=c.keys_package,e=c.size_table,f=this.string_to_array(a),e=e[f.length];if(this.is_empty(d)||void 0==e)return b;for(var g=e.length,k,h=0;h<g;h++)if(k=e[h],this.same_array(f,d[k].key)){b=d[k].count;break}return b}},n={};n.Listener=function(){function a(a){this.active_keys={};this.keys_package={};this.size_table={};this.first_to_id={};this.machine={};this.keydown_buffer=[];this.keyup_buffer=[];a=a||document.body;m.cross_browser();m.attach_event(a,"keyup",function(a){return function(c){return a.user_input(c,
!1)}}(this))}a.extend=function(c){for(var b in c)a.prototype[b]=c[b]};a.extend({unordered_combo:function(a,b,d){m.add_combo(a,b,d,!1,this)},ordered_combo:function(a,b,d){m.add_combo(a,b,d,!0,this)},delete_combo:function(a){m.destroy_combo(a,this)},delete_all:function(){m.destroy_all(this)},user_input:function(a,b){var d=a.keyCode;b?m.fire_keydown(d,this):m.fire_keyup(d,this)},count_times:function(a){return m.count(a,this)},get_keypackage:function(){return this.keys_package},get_sizetable:function(){return this.size_table},
get_activekeys:function(){return this.active_keys},get_id:function(){return this.first_to_id},get_machine:function(){return this.machine},get_buffer:function(){return this.keyup_buffer}});return a}();"undefined"!==typeof module&&"undefined"!==typeof module.exports?module.exports=n:"function"===typeof define&&define.amd?define([],function(){return n}):window.Input=n})();